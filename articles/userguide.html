<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Managing files with the Gobbler • gobbler</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Managing files with the Gobbler">
<meta property="og:description" content="gobbler">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gobbler</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/userguide.html">Managing files with the Gobbler</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ArtifactDB/gobbler-R/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Managing files with the Gobbler</h1>
                        <h4 data-toc-skip class="author">Aaron Lun</h4>
                  <a class="author_email" href="mailto:#"></a><a href="mailto:infinite.monkeys.with.keyboards@gmail.com" class="email">infinite.monkeys.with.keyboards@gmail.com</a>
      
                  
            <h4 data-toc-skip class="date">Revised: February 15,
2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ArtifactDB/gobbler-R/blob/HEAD/vignettes/userguide.Rmd" class="external-link"><code>vignettes/userguide.Rmd</code></a></small>
      <div class="hidden name"><code>userguide.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <em><a href="https://github.com/ArtifactDB/gobbler-R" class="external-link">gobbler</a></em> package
implements an R client for the <a href="https://github.com/ArtifactDB/gobbler" class="external-link">service of the same
name</a>. This allows Bioconductor packages to easily store and read
data on a managed registry in a shared filesystem. It also provides
mechanisms for project maintainers to easily manage upload
authorizations and third-party contributions. Readers are referred to <a href="https://github.com/ArtifactDB/gobbler?tab=readme-ov-file#gobbling-data-on-shared-filesystems" class="external-link">Gobbler
documentation</a> for a description of the concepts; this guide will
strictly focus on the usage of the <em><a href="https://github.com/ArtifactDB/gobbler-R" class="external-link">gobbler</a></em>
package.</p>
</div>
<div class="section level2">
<h2 id="demonstration-setup">Demonstration setup<a class="anchor" aria-label="anchor" href="#demonstration-setup"></a>
</h2>
<p>The rest of this vignette assumes that a Gobbler service is actually
running on a shared filesystem, with known locations for the staging
directory and registry. For demonstration purposes, we’ll set up a test
instance of the service with some temporary paths for the staging
directory and registry. Real applications should run the service outside
of R, e.g., via <code>systemctl</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ArtifactDB/gobbler-R" class="external-link">gobbler</a></span><span class="op">)</span></span>
<span><span class="va">info</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/startGobbler.html">startGobbler</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">STAGING</span> <span class="op">&lt;-</span> <span class="va">info</span><span class="op">$</span><span class="va">staging</span></span>
<span><span class="va">REGISTRY</span> <span class="op">&lt;-</span> <span class="va">info</span><span class="op">$</span><span class="va">registry</span></span>
<span><span class="va">URL</span> <span class="op">&lt;-</span> <span class="va">info</span><span class="op">$</span><span class="va">url</span></span></code></pre></div>
<p>As we’re the administrators of this instance, we can just create a
new project outselves:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/createProject.html">createProject</a></span><span class="op">(</span><span class="st">"test"</span>, staging<span class="op">=</span><span class="va">STAGING</span>, url<span class="op">=</span><span class="va">URL</span><span class="op">)</span></span></code></pre></div>
<p>We’ll also upload a new project to the registry, just for
demonstration purposes.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">src</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/allocateUploadDirectory.html">allocateUploadDirectory</a></span><span class="op">(</span><span class="va">STAGING</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"foo"</span><span class="op">)</span>, <span class="st">"BAR"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"whee"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"whee"</span>, <span class="st">"blah"</span><span class="op">)</span>, <span class="st">"stuff"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"whee2"</span><span class="op">)</span>, <span class="st">"more-stuff"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/uploadDirectory.html">uploadDirectory</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"simple"</span>, <span class="st">"v1"</span>, <span class="va">src</span>, staging<span class="op">=</span><span class="va">STAGING</span>, url<span class="op">=</span><span class="va">URL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reading-files">Reading files<a class="anchor" aria-label="anchor" href="#reading-files"></a>
</h2>
<p><em><a href="https://github.com/ArtifactDB/gobbler-R" class="external-link">gobbler</a></em> provides
several convenience methods for examining the Gobbler registry:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/listAssets.html">listAssets</a></span><span class="op">(</span><span class="st">"test"</span>, registry<span class="op">=</span><span class="va">REGISTRY</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "simple"</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/listVersions.html">listVersions</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"simple"</span>, registry<span class="op">=</span><span class="va">REGISTRY</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "v1"</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/listFiles.html">listFiles</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"simple"</span>, <span class="st">"v1"</span>, registry<span class="op">=</span><span class="va">REGISTRY</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "..manifest" "..summary"  "foo"        "whee/blah"  "whee2"</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/versionPath.html">versionPath</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"simple"</span>, <span class="st">"v1"</span>, registry<span class="op">=</span><span class="va">REGISTRY</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/tmp/RtmpnLflyn/file48b3f1062df/test/simple/v1"</span></span></code></pre>
<p>We can fetch the summaries and manifests for each version of a
project’s assets.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fetchManifest.html">fetchManifest</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"simple"</span>, <span class="st">"v1"</span>, registry<span class="op">=</span><span class="va">REGISTRY</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $foo</span></span>
<span><span class="co">## $foo$size</span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $foo$md5sum</span></span>
<span><span class="co">## [1] "f98bf6f12e995a053b7647b10d937912"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`whee/blah`</span></span>
<span><span class="co">## $`whee/blah`$size</span></span>
<span><span class="co">## [1] 6</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`whee/blah`$md5sum</span></span>
<span><span class="co">## [1] "9eb84090956c484e32cb6c08455a667b"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $whee2</span></span>
<span><span class="co">## $whee2$size</span></span>
<span><span class="co">## [1] 11</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $whee2$md5sum</span></span>
<span><span class="co">## [1] "aeed28071296d9424ea4b7eee861386c"</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fetchSummary.html">fetchSummary</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"simple"</span>, <span class="st">"v1"</span>, registry<span class="op">=</span><span class="va">REGISTRY</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $upload_user_id</span></span>
<span><span class="co">## [1] "root"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $upload_start</span></span>
<span><span class="co">## [1] "2024-04-23 15:38:32 UTC"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $upload_finish</span></span>
<span><span class="co">## [1] "2024-04-23 15:38:32 UTC"</span></span></code></pre>
<p>We can get the latest version of an asset:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fetchLatest.html">fetchLatest</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"simple"</span>, registry<span class="op">=</span><span class="va">REGISTRY</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "v1"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="uploading-files">Uploading files<a class="anchor" aria-label="anchor" href="#uploading-files"></a>
</h2>
<div class="section level3">
<h3 id="basic-usage">Basic usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h3>
<p>To demonstrate, let’s say we have some files that we wish to upload
to the registry. We allocate a subdirectory in the staging directory and
we put our files into it.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Not strictly necessary to use allocateUploadDirectory here, but it avoids an</span></span>
<span><span class="co"># extra link/copy step in uploadDirectory, so we might as well use it. </span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/allocateUploadDirectory.html">allocateUploadDirectory</a></span><span class="op">(</span><span class="va">STAGING</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="st">"foo"</span><span class="op">)</span>, <span class="va">letters</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="st">"bar"</span><span class="op">)</span>, <span class="va">LETTERS</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="st">"whee"</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>Then we run <code><a href="../reference/uploadDirectory.html">uploadDirectory()</a></code> with the specified
parameters.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/uploadDirectory.html">uploadDirectory</a></span><span class="op">(</span></span>
<span>    project<span class="op">=</span><span class="st">"test"</span>,</span>
<span>    asset<span class="op">=</span><span class="st">"new_asset"</span>,</span>
<span>    version<span class="op">=</span><span class="st">"new_version"</span>,</span>
<span>    directory<span class="op">=</span><span class="va">tmp</span>,</span>
<span>    staging<span class="op">=</span><span class="va">STAGING</span>,</span>
<span>    url<span class="op">=</span><span class="va">URL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check that it was actually uploaded to the registry:</span></span>
<span><span class="fu"><a href="../reference/fetchManifest.html">fetchManifest</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"new_asset"</span>, <span class="st">"new_version"</span>, registry<span class="op">=</span><span class="va">REGISTRY</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $bar</span></span>
<span><span class="co">## $bar$size</span></span>
<span><span class="co">## [1] 52</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $bar$md5sum</span></span>
<span><span class="co">## [1] "0eb827652a5c272e1c82002f1c972018"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $foo</span></span>
<span><span class="co">## $foo$size</span></span>
<span><span class="co">## [1] 52</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $foo$md5sum</span></span>
<span><span class="co">## [1] "b7fdd99fac291c4bbf958d9aee731951"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $whee</span></span>
<span><span class="co">## $whee$size</span></span>
<span><span class="co">## [1] 21</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $whee$md5sum</span></span>
<span><span class="co">## [1] "c34bcea9f2263deb3379103c9f10c130"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="link-generation">Link generation<a class="anchor" aria-label="anchor" href="#link-generation"></a>
</h3>
<p>More advanced developers can improve efficiency by explicitly
deduplicating files in their upload directories. This is achieved by
creating symbolic links to existing files in the Gobbler registry. The
Gobbler will automatically recognize symbolic links in the upload
directory that target files in the registry, and avoid creating extra
copies of those files. The Gobbler will also automatically attempt to
deduplicate files that are the same across consecutive versions of the
same asset, based on the file size and MD5 checksums.</p>
<p>This capability is particularly useful when creating new versions of
existing assets. Only the modified files need to be uploaded, while the
rest of the files can be linked to their counterparts in the previous
version. In fact, this pattern is so common that it can be expedited via
<code><a href="../reference/cloneVersion.html">cloneVersion()</a></code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/allocateUploadDirectory.html">allocateUploadDirectory</a></span><span class="op">(</span><span class="va">STAGING</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/cloneVersion.html">cloneVersion</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"simple"</span>, <span class="st">"v1"</span>, destination<span class="op">=</span><span class="va">dest</span>, registry<span class="op">=</span><span class="va">REGISTRY</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Do some modifications in 'dest' to create a new version, e.g., add a file.</span></span>
<span><span class="co"># However, users should treat symlink targets as read-only - so if you want to</span></span>
<span><span class="co"># modify a file, instead delete the symlink and replace it with a new file.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dest</span>, <span class="st">"BFFs"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Aaron"</span>, <span class="st">"Jayaram"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then we can just pass this directory back to
<code><a href="../reference/uploadDirectory.html">uploadDirectory()</a></code>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/uploadDirectory.html">uploadDirectory</a></span><span class="op">(</span></span>
<span>    project<span class="op">=</span><span class="st">"test"</span>,</span>
<span>    asset<span class="op">=</span><span class="st">"links"</span>,</span>
<span>    version<span class="op">=</span><span class="st">"whee"</span>,</span>
<span>    directory<span class="op">=</span><span class="va">dest</span>,</span>
<span>    staging<span class="op">=</span><span class="va">STAGING</span>,</span>
<span>    url<span class="op">=</span><span class="va">URL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Automatically converts the cloned files into links.</span></span>
<span><span class="va">mann</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchManifest.html">fetchManifest</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"links"</span>, <span class="st">"whee"</span>, registry<span class="op">=</span><span class="va">REGISTRY</span><span class="op">)</span></span>
<span><span class="va">mann</span><span class="op">[[</span><span class="st">"foo"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">link</span></span></code></pre></div>
<pre><code><span><span class="co">## $project</span></span>
<span><span class="co">## [1] "test"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $asset</span></span>
<span><span class="co">## [1] "simple"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $version</span></span>
<span><span class="co">## [1] "v1"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $path</span></span>
<span><span class="co">## [1] "foo"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="changing-permissions">Changing permissions<a class="anchor" aria-label="anchor" href="#changing-permissions"></a>
</h2>
<p>Upload authorization is determined by each project’s permissions,
which are controlled by project owners. Both uploaders and owners are
identified based on their user IDs (UIDs):</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fetchPermissions.html">fetchPermissions</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="va">REGISTRY</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $owners</span></span>
<span><span class="co">## $owners[[1]]</span></span>
<span><span class="co">## [1] "root"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $uploaders</span></span>
<span><span class="co">## list()</span></span></code></pre>
<p>Owners can add more uploaders (or owners) via the
<code><a href="../reference/setPermissions.html">setPermissions()</a></code> function. Uploaders can be scoped to
individual assets or versions, and an expiry date may be attached to
each authorization:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/setPermissions.html">setPermissions</a></span><span class="op">(</span></span>
<span>    <span class="st">"test"</span>, </span>
<span>    uploaders<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            id<span class="op">=</span><span class="st">"jkanche"</span>, </span>
<span>            until<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">60</span>,</span>
<span>            asset<span class="op">=</span><span class="st">"jays-happy-fun-time"</span>,</span>
<span>            version<span class="op">=</span><span class="st">"1"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    staging<span class="op">=</span><span class="va">STAGING</span>,</span>
<span>    url<span class="op">=</span><span class="va">URL</span>,</span>
<span>    registry<span class="op">=</span><span class="va">REGISTRY</span>    </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/fetchPermissions.html">fetchPermissions</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="va">REGISTRY</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $owners</span></span>
<span><span class="co">## $owners[[1]]</span></span>
<span><span class="co">## [1] "root"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $uploaders</span></span>
<span><span class="co">## $uploaders[[1]]</span></span>
<span><span class="co">## $uploaders[[1]]$id</span></span>
<span><span class="co">## [1] "jkanche"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $uploaders[[1]]$asset</span></span>
<span><span class="co">## [1] "jays-happy-fun-time"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $uploaders[[1]]$version</span></span>
<span><span class="co">## [1] "1"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $uploaders[[1]]$until</span></span>
<span><span class="co">## [1] "2024-04-24 15:38:33 UTC"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="probational-uploads">Probational uploads<a class="anchor" aria-label="anchor" href="#probational-uploads"></a>
</h2>
<p>Uploads can be defined as “probational” whereby they must be approved
by the project owners before they are considered complete.
Alternatively, an owner may reject an upload, which deletes all the
uploaded files from the backend. This provides a mechanism for storing
files that may or may not be useful without committing to long-term
immutability. To demonstrate, let’s perform a probational upload:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/allocateUploadDirectory.html">allocateUploadDirectory</a></span><span class="op">(</span><span class="va">STAGING</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="st">"stuff"</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/uploadDirectory.html">uploadDirectory</a></span><span class="op">(</span></span>
<span>    project<span class="op">=</span><span class="st">"test"</span>,</span>
<span>    asset<span class="op">=</span><span class="st">"probational"</span>,</span>
<span>    version<span class="op">=</span><span class="st">"thingy"</span>,</span>
<span>    directory<span class="op">=</span><span class="va">tmp</span>,</span>
<span>    staging<span class="op">=</span><span class="va">STAGING</span>,</span>
<span>    url<span class="op">=</span><span class="va">URL</span>,</span>
<span>    probation<span class="op">=</span><span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summary has the on_probation=TRUE flag.</span></span>
<span><span class="fu"><a href="../reference/fetchSummary.html">fetchSummary</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"probational"</span>, <span class="st">"thingy"</span>, <span class="va">REGISTRY</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $upload_user_id</span></span>
<span><span class="co">## [1] "root"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $upload_start</span></span>
<span><span class="co">## [1] "2024-04-23 15:38:33 UTC"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $upload_finish</span></span>
<span><span class="co">## [1] "2024-04-23 15:38:33 UTC"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $on_probation</span></span>
<span><span class="co">## [1] TRUE</span></span></code></pre>
<p>We can then approve (or reject) the probational status. This either
clears the <code>on_probation=</code> flag or it deletes the version
from the registry.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/approveProbation.html">approveProbation</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"probational"</span>, <span class="st">"thingy"</span>, staging<span class="op">=</span><span class="va">STAGING</span>, url<span class="op">=</span><span class="va">URL</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Flag is gone!</span></span>
<span><span class="fu"><a href="../reference/fetchSummary.html">fetchSummary</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"probational"</span>, <span class="st">"thingy"</span>, <span class="va">REGISTRY</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $upload_user_id</span></span>
<span><span class="co">## [1] "root"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $upload_start</span></span>
<span><span class="co">## [1] "2024-04-23 15:38:33 UTC"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $upload_finish</span></span>
<span><span class="co">## [1] "2024-04-23 15:38:33 UTC"</span></span></code></pre>
<p>Unless specified otherwise, all <code>uploaders</code> in the
permissions are considered to be “untrusted”, and any uploads from such
untrusted users are considered probational. This allows project
maintainers to manage third-party contributions that may need several
rounds of revision before approval. An uploader can be trusted by
setting <code>trusted=TRUE</code> in <code><a href="../reference/setPermissions.html">setPermissions()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="inspecting-the-quota">Inspecting the quota<a class="anchor" aria-label="anchor" href="#inspecting-the-quota"></a>
</h2>
<p>Currently, <a href="https://github.com/ArtifactDB/gypsum-worker" class="external-link"><strong>gypsum</strong></a>-like
storage quotas are not yet enforced by the Gobbler. Nonetheless, the
Gobbler keeps track of the current disk usage of the project:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fetchUsage.html">fetchUsage</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="va">REGISTRY</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 181</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="administration">Administration<a class="anchor" aria-label="anchor" href="#administration"></a>
</h2>
<p>Administrators are responsible for creating new projects with the
relevant permissions. Authorized users can then upload new
versions/assets via <code><a href="../reference/uploadDirectory.html">uploadDirectory()</a></code> to this project.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/createProject.html">createProject</a></span><span class="op">(</span><span class="st">"another-project"</span>, </span>
<span>    staging<span class="op">=</span><span class="va">STAGING</span>, </span>
<span>    url<span class="op">=</span><span class="va">URL</span>,</span>
<span>    owners<span class="op">=</span><span class="st">"LTLA"</span>, </span>
<span>    uploaders<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>id<span class="op">=</span><span class="st">"jkanche"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Administrators of the Gobbler service can manually refresh the latest
version for an asset and the disk usage for a project. This is required
on very rare occasions where there are simultaneous uploads to the same
project.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/refreshLatest.html">refreshLatest</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"simple"</span>, staging<span class="op">=</span><span class="va">STAGING</span>, url<span class="op">=</span><span class="va">URL</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/refreshUsage.html">refreshUsage</a></span><span class="op">(</span><span class="st">"test"</span>, staging<span class="op">=</span><span class="va">STAGING</span>, url<span class="op">=</span><span class="va">URL</span><span class="op">)</span></span></code></pre></div>
<p>Administrators may also delete projects, assets or versions, though
this should be done sparingly as it violates the Gobbler’s expectations
of immutability.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/removeProject.html">removeProject</a></span><span class="op">(</span><span class="st">"test"</span>, staging<span class="op">=</span><span class="va">STAGING</span>, url<span class="op">=</span><span class="va">URL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.4.0 RC (2024-04-16 r86441)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: Etc/UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] gobbler_0.3.3    BiocStyle_2.31.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] vctrs_0.6.5         cli_3.6.2           knitr_1.46         </span></span>
<span><span class="co">##  [4] rlang_1.1.3         xfun_0.43           purrr_1.0.2        </span></span>
<span><span class="co">##  [7] textshaping_0.3.7   jsonlite_1.8.8      glue_1.7.0         </span></span>
<span><span class="co">## [10] htmltools_0.5.8.1   ragg_1.3.0          sass_0.4.9         </span></span>
<span><span class="co">## [13] rappdirs_0.3.3      rmarkdown_2.26      evaluate_0.23      </span></span>
<span><span class="co">## [16] jquerylib_0.1.4     fastmap_1.1.1       yaml_2.3.8         </span></span>
<span><span class="co">## [19] lifecycle_1.0.4     httr2_1.0.1         memoise_2.0.1      </span></span>
<span><span class="co">## [22] bookdown_0.38       BiocManager_1.30.22 compiler_4.4.0     </span></span>
<span><span class="co">## [25] fs_1.6.3            htmlwidgets_1.6.4   systemfonts_1.0.6  </span></span>
<span><span class="co">## [28] digest_0.6.35       R6_2.5.1            curl_5.2.1         </span></span>
<span><span class="co">## [31] magrittr_2.0.3      bslib_0.7.0         tools_4.4.0        </span></span>
<span><span class="co">## [34] pkgdown_2.0.9       cachem_1.0.8        desc_1.4.3</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Aaron Lun.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
